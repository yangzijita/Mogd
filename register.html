<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>登录/注册</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/htmleaf-demo.css" />
    <script src="js/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href="css/register.css">
</head>

<body>
    <div class="htmleaf-container">
        <!-- 头部固定样式 -->
        <header class="htmleaf-header">
            <h1>Mogd</h1>
            <div class="htmleaf-links">
                <a class="htmleaf-icon icon-htmleaf-home-outline" href="#" title="主页" target="_blank"><span>主页
                    </span></a>
                <a class="htmleaf-icon icon-htmleaf-arrow-forward-outline" href="#" title="" target="_blank"><span>
                        返回上页</span></a>
            </div>
        </header>
        <!-- 表单开始 -->
        <div id="wrapper" class="login-page">
            <div id="login_form" class="form">
                <form class="register-form">
                    <!-- 
                  数据
                用户名： r_user_name
                   密码：    r_pwd
                    重复密码：    re_pwd
                       qq：     r_qq
                        手机：  r_phone
                        验证码   r_verification
                       手机验证码         r_phoneyzm
                       onchange="checkPhone()
               -->
                    <input type="text" id="phone" maxlength="11" " placeholder=" 请输入手机号" />
                    <!-- <input type="text" placeholder="用户名" id="r_user_name" /> -->
                    <input type="password" autocomplete="new-password" placeholder="密码" id="passwd" />
                    <input type="password" autocomplete="new-password" placeholder="重复密码" id="unpasswd" />
                    <input type="text" placeholder="QQ" id="qq" />

                    <div class="yzm-div">
                        <input type="text" maxlength="4" id="check_code" placeholder="请输入验证码" />
                        <img type="image" id="yzmimg" src="./IndexViews/CheckCode/" />
                    </div>
                    <div class="phoneyz">
                        <input type="text" maxlength="6" id="phone_code" placeholder="手机短信验证码" />
                        <input id="btnyzm" type="button" value="获取验证码"></input>
                    </div>
                    <input id="create" type="button" value="注册"></input>
                    <p class="message">
                        已经有了一个账户? <a href="login.html">立刻登录</a>
                    </p>
                </form>
            </div>
        </div>
    </div>




    <!-- 验证码随机 -->
    <script>
        var verifyImage = document.getElementById('yzmimg');
        verifyImage.onclick = function () {
            // 在（2）处使用Math对象随机生成一个0-1小数，实现点击刷新
            this.src = './IndexViews/CheckCode/?r=' + Math.random();
        }
    </script>
    <script>
        // function checkPhone() {
        //     var phone = document.getElementById('phone').value;
        //     var btn = $("#btnyzm");
        //     if (!(/^1[3456789]\d{9}$/.test(phone))) {
        //         // 需要先禁用按钮（为防止用户重复点击）
        //         // btn.unbind('click');
        //         // btn.attr('disabled', 'disabled');
        //         alert("手机号码有误，请重填");
        //         return false;
        //     }
            // var that = $(this)
            // 需要先禁用按钮（为防止用户重复点击）
            // btn.unbind('click');
            // btn.attr('disabled', 'disabled');
            // var timeo = 60;
            // var timeStop = setInterval(function () {
            //     timeo--;
            //     if (timeo > 0) {
            //         btn.text('重新发送' + timeo + 's');
            //         btn.attr('disabled', 'disabled');//禁止点击
            //     } else {
            //         btn = 60;//当减到0时赋值为60
            //         btn.text('获取验证码');
            //         clearInterval(timeStop);//清除定时器
            //         btn.removeAttr('disabled');//移除属性，可点击
            //     }
            // }, 1000)
        // }

        // function checkPhone_cd() {

        //     var btn = $("#btnyzm");

        // }
        // var btn = $("#btnyzm");
        // var countdown = 60;
        // function settime() {
        //     if (countdown == 0) {
        //         btn.removeAttribute("disabled");
        //         btn.value = "获取验证码";
        //         countdown = 60;
        //         return false;
        //     } else {
        //         btn.setAttribute("disabled", true);
        //         btn.value = "重新发送(" + countdown + ")";
        //         countdown--;
        //     }
        //     setTimeout(function () {
        //         settime(btn);
        //     }, 1000);
        // }




        // function checkQq() {
        //     var qq = document.getElementById('qq').value;
        //     var btn = $("#create");
        //     if (!(/^\d+(\.\d+)?$/.test(qq))) {
        //         // 需要先禁用按钮（为防止用户重复点击）
        //         btn.unbind('click');
        //         btn.attr('disabled', 'disabled');
        //         alert("QQ有误，请重填");
        //         return false;
        //     }
        // }
    </script>
    <!-- 手机验证码 -->
    <script>
        $("#create").click(function () {
            var dic = {
                passwd: $("#passwd").val(),
                unpasswd: $("#unpasswd").val(),
                qq: $("#qq").val(),
                phone: $("#phone").val(),
                check_code: $("#check_code").val(),
                phone_code: $("#phone_code").val()
            };

            if (dic.passwd == null || dic.passwd == "") {
                alert("mima1 null");
            } else if (dic.unpasswd == null || dic.unpasswd == "") {
                alert("mima1 null");
            }
            /**校验确认密码*/
            else if (dic.passwd != dic.unpasswd) {
                alert('2次密码不一样');
            }
            else if (dic.qq == null || dic.qq == "") {
                alert("qq-不能为空");
            }
            else if (dic.phone == null || dic.phone == "") {
                alert("手机号不能为空");
            } else if (dic.check_code == null || dic.check_code == "") {
                alert("验证码不能为空");
            }
            else if (dic.phone_code == null || dic.phone_code == "") {
                alert("手机验证码不能为空");
            } else {
                console.log(dic);
                // 将获取的字符串转换为 json数据
                var msg = JSON.stringify(dic);
                // var $test = $(".test");
                // ajax发送
                $.ajax({
                    // 发送到的地址
                    url: "./IndexViews/Regist/",
                    //请求方式
                    type: "post",
                    //指定请求的数据格式为json
                    contentType: "application/json",
                    // 数据
                    data: msg,
                    //指定响应的格式为json,注意如果后台没有放回json类型的数据格式下方的success不会执行
                    dataType: "json",
                    success: function (res) {
                        console.log(res);
                        rs = res;
                        if (rs.status != 200) {
                            alert(rs.data[0].info);
                        } else if (rs.status == 200) {
                            alert(rs.data[0].info);
                            location.href = "./login.html";
                        }
                    },
                    error: function () {
                        console.log("请求出错！");
                    }
                });
            }
        });
    </script>

</body>
<!-- 手机验证码提交 -->
<!-- <script>
    $('#btnyzm').on('click', function () {
        var that = $(this)
        var timeo = 60;
        var timeStop = setInterval(function () {
            timeo--;
            if (timeo > 0) {
                that.text('重新发送' + timeo + 's');
                that.attr('disabled', 'disabled');//禁止点击
            } else {
                timeo = 60;//当减到0时赋值为60
                that.text('获取验证码');
                clearInterval(timeStop);//清除定时器
                that.removeAttr('disabled');//移除属性，可点击
            }
        }, 1000)
    })
</script> -->


<script>
    $("#btnyzm").click(function () {
        var btn = $("#btnyzm");
        var dic = {
            passwd: $("#passwd").val(),
            unpasswd: $("#unpasswd").val(),
            qq: $("#qq").val(),
            phone: $("#phone").val(),
            check_code: $("#check_code").val()
        };
        // var phone = document.getElementById('phone').value;
        //     // var btn = $("#btnyzm");
        //     if (!(/^1[3456789]\d{9}$/.test(phone))) {
        //         // 需要先禁用按钮（为防止用户重复点击）
        //         // btn.unbind('click');
        //         // btn.attr('disabled', 'disabled');
        //         alert("手机号码有误，请重填");
        //         return false;
        //     }
        if (!(/^1[3456789]\d{9}$/.test(dic.phone))) {
            // 需要先禁用按钮（为防止用户重复点击）
            // btn.unbind('click');
            // btn.attr('disabled', 'disabled');
            alert("手机号码有误，请重填");
            return false;
        } else if (!(/^1[3456789]\d{9}$/.test(dic.phone))) {
            // 需要先禁用按钮（为防止用户重复点击）
            // btn.unbind('click');
            // btn.attr('disabled', 'disabled');
            alert("手机号码有误，请重填");
            return false;
        } else if (!(/^\d+(\.\d+)?$/.test(dic.qq))) {
            // 需要先禁用按钮（为防止用户重复点击）
            btn.unbind('click');
            btn.attr('disabled', 'disabled');
            alert("QQ有误，请重填");
            return false;
        } else if (dic.passwd != dic.unpasswd) {
            alert('2次密码不一样');

        } else {
            var timeo = 60;
            var timeStop = setInterval(function () {
                // alert('111');
                timeo--;
                if (timeo > 0) {
                    btn.val('重新发送' + timeo + 's');
                    // btn.text("111111111");
                    btn.attr('disabled', 'disabled');//禁止点击
                } else {
                    btn = 60;//当减到0时赋值为60
                    btn.val('获取验证码');
                    clearInterval(timeStop);//清除定时器
                    btn.removeAttr('disabled');//移除属性，可点击
                }
            }, 1000)


        }

        var msg = JSON.stringify(dic);
        // var $test = $(".test");
        // ajax发送
        $.ajax({
            // 发送到的地址
            url: "./IndexViews/SendCode/",
            //请求方式
            type: "post",
            //指定请求的数据格式为json
            contentType: "application/json",
            // 数据
            data: msg,
            //指定响应的格式为json,注意如果后台没有放回json类型的数据格式下方的success不会执行
            dataType: "json",
            success: function (res) {
                // console.log(res);
                rs = res;
                if (rs.status != 200) {
                    alert(rs.data[0].info);
                } else if (rs.status == 200) {
                    alert(rs.data[0].info);
                }
            },
            error: function () {
                console.log("请求出错！");
            }
        });

    });
</script>

</html>